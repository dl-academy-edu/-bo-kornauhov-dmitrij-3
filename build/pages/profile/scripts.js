"use strict";var n,o,s,a,c,u,t,r,i=document.querySelector(".profile-name_js"),d=document.querySelector(".profile-surname_js"),l=document.querySelector(".profile-email_js"),p=document.querySelector(".profile-location_js"),m=document.querySelector(".profile-age_js"),f=document.querySelector(".profile-photo_js"),h=localStorage.getItem("token"),e=localStorage.getItem("userId"),w=document.querySelector(".delete_js"),g={};function P(e){i.innerText=e.name,d.innerText=e.surname,l.innerText=e.email,p.innerText=e.location,m.innerText=e.age,f.innerText="",f.style="background-image: url(".concat(SERVER_URL).concat(e.photoUrl,")")}n=document.querySelector(".change-password_js"),o=document.querySelector(".popup--change-password"),s=document.forms["change-password"],n&&n.addEventListener("click",function(){popup(o,n,s)}),s.addEventListener("submit",function(e){!function(t){t.preventDefault();var e=getFormData(t.target,{},"FormData"),r=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};0===e.oldPassword.length&&(t.oldPassword="Пожалуйста, введите старый пароль");e.newPassword.length<4&&(t.newPassword="Ваш пороль слишком короткий");e.repeatPassword===e.newPassword&&""!==e.repeatPassword||(t.repeatPassword="Вы неправильно повторили пароль");e.oldPassword===e.newPassword&&(t.newPassword="Новый пароль должен отличаться от старого");return t}(getFormData(t.target),r={});0<Object.keys(r).length?setFormErrors(t.target,r):fetchData({method:"PUT",body:e,url:"/api/users",headers:{"x-access-token":h}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw e;clearForm(t.target),setFormSuccess(t.target),setTimeout(function(){popupClose(o,n,s),answer(answerPopup,"Пароль был успешно изменён","success")},2e3)}).catch(function(e){e._message?answer(answerPopup,e._message,"error"):answer(answerPopup,"Ошибка сервера","error")})}(e)}),a=document.querySelector(".change-data_js"),c=document.querySelector(".popup--change-data"),u=document.forms["change-data"],t=document.querySelector(".file_js"),r=document.querySelector(".fileText_js"),a&&a.addEventListener("click",function(){setValueToForm(u,g),popup(c,a,u)}),t.addEventListener("input",function(){var e;t.value&&(20<(e=t.value.slice(12)).length&&(e=e.slice(0,20)+"..."),r.innerHTML=e)}),u.addEventListener("submit",function(e){!function(t){t.preventDefault();var e=getFormData(t.target,{},"FormData"),r=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!isNaN(e.age)&&""!==e.age||(t.age="Введите возраст");return t}(getFormData(t.target));0<Object.keys(r).length?setFormErrors(t.target,r):fetchData({method:"PUT",body:e,url:"/api/users",headers:{"x-access-token":h}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw e;P(e.data),setFormSuccess(t.target),setTimeout(function(){popupClose(c,a,u),answer(answerPopup,"Форма была успешно отправлена","success")},2e3)}).catch(function(e){e.errors?setFormErrors(u,e.errors):answer(answerPopup,"Ошибка сервера","error")})}(e)}),function(){if(!h||!e)return window.location="/";fetchData({method:"GET",url:"/api/users/".concat(e),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw e;P(g=e.data)}).catch(function(e){return window.location="/"})}(),w.addEventListener("click",function(){fetchData({method:"DELETE",url:"/api/users/".concat(e),headers:{"x-access-token":h}}).then(function(e){return e.json()}).then(function(e){if(!e.success)throw e;answer(answerPopup,"Пользователь был успешно удалён","success"),setTimeout(function(){logoutUser()},2e3)}).catch(function(){answer(answerPopup,"Ошибка сервера","error")})});