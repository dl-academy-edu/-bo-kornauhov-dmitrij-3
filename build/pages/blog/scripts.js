"use strict";function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=s(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,e=function(){};return{s:e,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,r=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw r}}}}function s(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var c,i,y,t,e,v,n,r,a,u=document.forms.filter,_={page:0};function S(t){t.preventDefault();t=_.page||0;(_=getFormData(u)).page=t,_.show=+_.show||0,function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=Object.keys(t),n=new URL("http://123.ru"),o=0,r=e;o<r.length;o++){var a=r[o];if("object"===l(t[a])){var c,s=b(t[a]);try{for(s.s();!(c=s.n()).done;){var i=c.value;n.searchParams.append(a,i)}}catch(t){s.e(t)}finally{s.f()}}else n.searchParams.append(a,t[a])}history.replaceState({},document.title,n.search)}(_),function(p){var t=new URL("http://123.ru");t.searchParams.set("v",VERSION_API),p.page||(p.page=0);p.tags&&t.searchParams.set("tags",JSON.stringify(p.tags));var e={};p.title&&(e.title=p.title);p.views&&(o=p.views.split("-"),e.views={$between:[o[0],o[1]]});{var n,o;0!==p.commentsCount.length&&(n=[],p.commentsCount.forEach(function(t){t.split("-").forEach(function(t){n.push(t)})}),o={min:Math.min.apply(null,n),max:Math.max.apply(null,n)},e.commentsCount={$between:[o.min,o.max]})}t.searchParams.set("filter",JSON.stringify(e));e=["id","ASC"];p.sort&&(e[0]=p.sort);t.searchParams.set("sort",JSON.stringify(e)),p.show&&t.searchParams.set("limit",JSON.stringify(+p.show));t.searchParams.set("offset",JSON.stringify(+p.show*p.page));var h=new XMLHttpRequest;h.open("GET","".concat(SERVER_URL,"/api/posts?").concat(t.searchParams)),h.send(),h.onload=function(){var t,e=JSON.parse(h.response);if(e.success){y.innerHTML="";var n,o=b(e.data);try{for(o.s();!(n=o.n()).done;){var r=n.value;y.innerHTML+=(t=r,'\n\t\t<li class="blog__item">\n\t\t\t<picture>\n\t\t\t\t<source srcset="'.concat(SERVER_URL).concat(t.photo.desktopPhotoUrl,'", srcset="').concat(SERVER_URL).concat(t.photo.desktop2xPhotoUrl,'" 2x" media="(min-width: 800px)">\n\t\t\t\t<source srcset="').concat(SERVER_URL).concat(t.photo.tabletPhotoUrl,', srcset="').concat(SERVER_URL).concat(t.photo.tablet2xPhotoUrl,' 2x" media="(min-width: 670px) and (max-width: 799px)">\n\t\t\t\t<source srcset="').concat(SERVER_URL).concat(t.photo.mobilePhotoUrl,', srcset="').concat(SERVER_URL).concat(t.photo.mobile2xPhotoUrl,' 2x" media="(max-width: 669px)">\n\t\t\t\t<img class="blog__img" src="').concat(SERVER_URL).concat(t.photo.desktopPhotoUrl,'" alt="').concat(t.title,'">\n\t\t\t</picture>\n\t\t\t<div class="blog__box">\n\t\t\t\t<div class="blog__tags cardTags_js"></div>\n\t\t\t\t<div class="blog__info">\n\t\t\t\t\t<span class="blog__data text-small">').concat(new Date(t.date).toLocaleDateString(),'</span>\n\t\t\t\t\t<span class="blog__views text-small">').concat(t.views,' views</span>\n\t\t\t\t\t<span class="blog__comments text-small">').concat(t.commentsCount,' comments</span>\n\t\t\t\t</div>\n\t\t\t\t<h3 class="blog__title title-three">').concat(t.title,'</h3>\n\t\t\t\t<p class="blog__text text">').concat(t.text,'</p>\n\t\t\t\t<a class="blog__link text text--bold" href="#">Go to this post</a>\n\t\t\t</div>\n\t\t</li>'));var a,c=g(document.querySelectorAll(".blog__item")),s=c[c.length-1].querySelector(".cardTags_js"),i=b(r.tags);try{for(i.s();!(a=i.n()).done;){var l=a.value;s.innerHTML+='<span class="blog__tag" style="background-color: '.concat(l.color,'"></span>')}}catch(t){i.e(t)}finally{i.f()}}}catch(t){o.e(t)}finally{o.f()}var u=e.count,f=0;for(v.innerHTML="";0<u-p.show;){u-=p.show;var m=w(f,_,function(t){S(t)});f++,v.insertAdjacentElement("beforeend",m)}var d=w(f,_,function(t){S(t)});v.insertAdjacentElement("beforeend",d)}else console.error(e._message)},h.onerror=function(){return console.error("Произошла ошибка сервера")}}(_)}function w(e,n,o){var t=document.createElement("li");t.classList.add("blog-pagination__item");var r=document.createElement("a");return r.setAttribute("href","?page=".concat(e)),r.classList.add("blog-pagination__link","text","text--bold","link_js"),e===n.page&&r.classList.add("active"),r.addEventListener("click",function(t){t.preventDefault(),n.page=e,o(t)}),r.innerText=+e+1,t.insertAdjacentElement("beforeend",r),t}i=document.querySelector(".tags_js"),y=document.querySelector(".posts_js"),t=document.querySelector(".search-button_js"),e=document.querySelector(".reset-button_js"),v=document.querySelector(".pagination_js"),n=document.querySelector(".left-arrow_js"),r=document.querySelector(".right-arrow_js"),a=document.querySelector(".preloader"),u.addEventListener("submit",S),t.addEventListener("click",function(){return _.page=0}),e.addEventListener("click",function(){setTimeout(function(){return t.click()},100)}),n.addEventListener("click",function(t){0<_.page&&(_.page--,S(t))}),r.addEventListener("click",function(t){var e=v.querySelectorAll("li");_.page<e.length-1&&(_.page++,S(t))}),setTimeout(function(){a.classList.add("hide_js")},1e3),i.innerHTML=spinnerCreator(),(c=new XMLHttpRequest).open("GET","".concat(SERVER_URL,"/api/tags")),c.send(),c.onload=function(){var t,e=JSON.parse(c.response);if(e.success){i.innerHTML="";var n,o=b(e.data);try{for(o.s();!(n=o.n()).done;){var r=n.value;i.innerHTML+='\n\t\t<label class="filter-form__checkbox-label filter-form__checkbox-label--tags">\n\t\t\t<input class="filter-form__checkbox hidden" type="checkbox" name="tags" value="'.concat((t=r).id,'" aria-label="Tag ').concat(t.color,'" checked>\n\t\t\t<span style="border-color: ').concat(t.color,'" class="filter-form__checkbox-checker filter-form__checkbox-checker--tags filter-form__checkbox-checker--').concat(t.color.slice(1),'"></span>\n\t\t</label>')}}catch(t){o.e(t)}finally{o.f()}var a=function(){var t=new URL(window.location).searchParams,e={};t.has("tags")&&(e.tags=t.getAll("tags"));t.has("views")&&(e.views=t.get("views"));t.has("commentsCount")&&(e.commentsCount=t.getAll("commentsCount"));t.has("show")&&(e.show=t.get("show"));t.has("sort")&&(e.sort=t.get("sort"));t.has("title")&&(e.title=t.get("title"));t.has("page")&&(e.page=t.get("page"));return e}();setValueToForm(u,a)}else console.error(e._message)},c.onerror=function(){return console.error("Произошла ошибка сервера")},setTimeout(function(){return t.click()},1e3);